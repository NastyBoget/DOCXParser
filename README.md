# Извлечение метаданных и текста из docx-документов

Общее устройство обработчика docx файлов выглядит следующим образом:

* document\_parser - основной модуль с обработчиком файлов;
* data\_structures - набор вспомогательных структур, таких как параграф, текстовый элемент (run по документации) и свойства параграфа;
* properties\_extractor - модуль для выделения из xml-параграфов различных свойств;
* styles\_extractor - модуль для анализа стилей и применения стилей к параграфам;
* numbering\_extractor - модуль для извлечения текстового содержимого нумерации списков.


Модуль document\_parser содержит класс DOCXParser со следующими методами:

* can\_parse - проверяет, можно ли обработать файл с заданным именем;
* parse - обрабатывает файл, результат сохраняется внутри класса;
* get\_lines\_with\_meta - возвращает список строк документа с необходимыми метаданными.

    
Модуль data\_structures содержит нескольно модулей:

* base\_props - содержит базовый класс BaseProperties для Run и Paragraph, который хранит в себе общие для Paragraph и Run свойства: отступ, выравнивание, размер шрифта, жирность, курсив, подчеркивание. У параграфов и у их частей могут присутствовать и отсутствовать некоторые общие свойства, которые применяются по иерархии, поэтому удобно использовать общий базовый класс.
* paragraph - соответствует параграфу docx, содержит класс Paragraph, который помимо свойств BaseProperties хранит список текстовых элементов (run), информацию о стиле и уровне вложенности списка (если есть). Метод parse формирует свойства параграфа в соответствии с иерархией применяемых стилей и сохраняет их внутри класса.
* run - соответствует текстовому элементу (run) в docx, содержит класс Run, который помимо свойств BaseProperties хранит текст части параграфа. Метод get\_text формирует текст элемента на основе xml и сохраняет его внутри класса.
* paragraph\_info - содержит класс ParagraphInfo, который преобразует свойства параграфа в аннотации - для параграфа формируется список кортежей с названием аннотации, ее значением и координатами начала и конца применения аннотации к тексту параграфа. Метод get\_info - формирует и возвращает для параграфа словарь с его текстом и списком аннотаций.


Модуль properties\_extractor содержит набор функций, которые на основе Run или Paragraph и xml-содержимого обновляют свойства параграфа или текстового элемента:

* change\_paragraph\_properties - изменяет отступ, размер шрифта и выравнивание параграфа;
* change\_run\_properties - изменяет жирность, курсив, подчеркивание, размер шрифта;
* change\_indent - изменяет отступ;
* change\_size - изменяет размер шрифта;
* change\_js - изменяет выравнивание.


Модуль styles\_extractor содержит класс StylesExtractor, в конструкторе которого сохраняются xml-деревья с настройками стилей по умолчанию; метод parse изменяет свойства Paragraph или Run в соответствии с иерархией стилей и с тем стилем, styleId которого передан, также может добавиться текстовый элемент с нумерацией.

Модуль numbering\_extractor содержит следующие классы:

* класс AbstractNum соотвествует abstractNum в docx, описывает свойства типа списка.
    В конструкторе инициализируются свойства, общие для всех уровней и словарь свойств для каждого уровня; метод parse обрабатывает список уровней, заполняя свойства каждого уровня.
* класс Num соотвествует num в docx, наследует все свойства одного из AbstractNum и перегружает некоторые из них, в конструкторе получает информацию о свойствах всех уровней списка. Метод get\_level\_info возвращает словарь со свойствами для конкретного уровня списка.
* класс NumberingExtractor строит соответствие между Num и AbstractNum и вычисляет текст и свойства нумерации списков. Метод parse формирует текстовый элемент с нумерацией и добавляет нумерацию к переданному в качестве параметра параграфу.


